#!/usr/bin/env bash

# TODO: Make a ffmpeg script which takes all the mp4 files in a folder (recursively) and output them in the same position mp3 file
#
# E.g.:
# Videos
# ├── Clips
# │   ├── clip1.mp4
# │   └── clip2.mp4
# ├── Movies
# │   ├── movie1.mp4
# │   └── movie2.mp4
# └── Songs
#     ├── Song1.mp4
#     └── Song2.mp4
# music-extract Videos
#
# The above folder will create another folder with the position of file with just there audio
# Music
# ├── Clips
# │   ├── clip1.mp3
# │   └── clip2.mp3
# ├── Movies
# │   ├── movie1.mp3
# │   └── movie2.mp3
# └── Songs
#     ├── Song1.mp3
#     └── Song2.mp3

convert_video_to_audio() {
 local file_path="$1"
    local output_dir="Music/${file_path%/*}"
    mkdir -p "$output_dir"
    local output_path="Music/${file_path%.mp4}.mp3"
    ffmpeg -i "$file_path" -vn -ar 44100 -ac 2 -b:a 192k "$output_path"
}

find_To_Convert_Files_From_Video_To_Audio() {
    local dir="$1"
    find "$dir" -type f -name '*.mp4' -print0 | while IFS= read -r -d '' file; do
        convert_video_to_audio "$file"
    done
}

find_To_Convert_Files_From_Video_To_Audio "videos"
