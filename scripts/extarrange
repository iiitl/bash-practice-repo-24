#!/usr/bin/env bash

require() {
    command -v "$1" 1>/dev/null || { >&2 echo "Error: $1 is not installed";exit 1; }
}

require fd
require egrep

declare -A special_cases=(
    ['^*.(tar.*|tbz)$']='tar'
    ['\.docx?$']='doc'
    ['\.(mp3|wav|flac|aac|ogg|wma|m4a)$']='audio'
    ['\.css$']='css'
    ['\.pptx?$']='ppt'
    ['\.html?$']='html'
    ['\.(jpe?g|png|gif|bmp|svg|psd|tiff)$']='images'
    ['\.pdf$']='pdf'
    ['\.cpp$']='cpp'
    ['\.js$']='js'
    ['\.java$']='java'
    ['\.c$']='c'
    ['\.sh$']='sh'
    ['\.py$']='python'
)

fd -tf -d1 \
| while read file; do
    folder="$PWD/${file##*.}"
    for regex in "${!special_cases[@]}"; do
        (echo "$file" | egrep -q "$regex") && {
            folder="$PWD/${special_cases[$regex]}"
            break
        }
    done

    mkdir -p "$folder"
    mv "$file" "$folder"
done

